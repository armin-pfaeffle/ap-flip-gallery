!function(a){function f(a){a+="";var b=a[0].toUpperCase();return b+a.substr(1)}function g(c,d){var e=a(c).data(b);return e?e:(this.settings=a.extend({},g.defaultSettings,d),this.$target=a(c),this.$images=this.$target.find("img"),this._init(),this.$target.data(b,this),void 0)}var b="__apfg__",c="apfg-",d="apfg",e=0;String.prototype.ucfirst||(String.prototype.ucfirst=function(){return f(this)}),a.fn.shuffle=function(){var a=this.length;if(a>1)for(var b;--a;)b=Math.floor(Math.random()*(a+1)),t=this[b],this[b]=this[a],this[a]=t;return this},g.prototype={_init:function(){this.active=!1,this.flipping=!1,this.flipCounter=0,this.$target.data("visible",this.$target.is(":visible")).hide(),this._addWrapper(),this._initTilesAndImages(),this._updateHeadCss(),this._setCssClasses(),this._trigger("init"),this.settings.autoStart&&this.start()},_addWrapper:function(){this.$wrapper=a("<div></div>").addClass(c+"wrapper").addClass(c+"clearfix").insertAfter(this.$target);var b="string"==typeof this.settings.id?this.settings.id:c+"wrapper-"+e++;this.$wrapper.attr("id",b)},_initTilesAndImages:function(){var b=this;this.settings.randomImages&&this.$images.shuffle(),this.$tiles=a("<ul></ul>").addClass(c+"images"),this.$tiles.appendTo(this.$wrapper);for(var d=0,e=0;e<this.settings.tileCount;e++){var f=a("<li></li>");this.$tiles.append(f);var g="object"==typeof this.settings.customTiles&&this.settings.customTiles.indexOf(e)>-1;if(g||d>=this.$images.length)f.addClass(c+"custom");else{var h=a("<div></div>").addClass(c+"front").appendTo(f);a("<div></div>").addClass(c+"back").appendTo(f),this._cloneImage(this.$images.eq(d)).appendTo(h),d++}this._trigger("initTile",[g],f)}this.$hiddenImages=a(),this.$images.slice(d).each(function(){b.$hiddenImages=b.$hiddenImages.add(b._cloneImage(a(this)))}),this._resetAvailableTiles()},_cloneImage:function(b){var c=a("<img />").attr({src:b.attr("src"),width:b.attr("width"),height:b.attr("height")});return c},_resetAvailableTiles:function(){this.$availableTiles=this.$tiles.children(":not(."+c+"custom)"),this.settings.randomDestinationTiles&&this.$availableTiles.shuffle()},_updateHeadCss:function(){this._removeHeadCss();var b=this.$wrapper.attr("id"),c=(parseInt(this.settings.animationDuration)/1e3).toFixed(3)+"s";this.cssStyle=a("<style type='text/css'>#"+b+" > .apfg-images > li.apfg-flip > div {\n"+"	-webkit-transition: "+c+";\n"+"	   -moz-transition: "+c+";\n"+"	    -ms-transition: "+c+";\n"+"	     -o-transition: "+c+";\n"+"	        transition: "+c+";\n"+"	}\n"+"</style>").appendTo("head")},_removeHeadCss:function(){this.cssStyle&&this.cssStyle.remove()},_setCssClasses:function(){this.active?this.$wrapper.addClass(c+"active"):this.$wrapper.removeClass(c+"active"),this.settings.enabled?this.$wrapper.removeClass(c+"disabled"):this.$wrapper.addClass(c+"disabled"),this.settings.randomImages?this.$wrapper.removeClass(c+"random-images"):this.$wrapper.addClass(c+"random-images"),this.settings.randomDestinationTiles?this.$wrapper.removeClass(c+"random-destination-tiles"):this.$wrapper.addClass(c+"random-destination-tiles")},_flipImage:function(){if(this.settings.enabled&&0!=this.$hiddenImages.length&&(this.settings.randomImages&&this.flipCounter==this.$hiddenImages.length&&(this.$hiddenImages.shuffle(),this.flipCounter=0),!this.flipping)){this.flipping=!0;var b=a(this.$hiddenImages.splice(0,1)),d=a(this.$availableTiles.splice(0,1));d.children("."+c+"back").append(b),d.addClass(c+"flip");var e=this.$tiles.children().index(d);this._trigger("flip",[e],d);var f=this;setTimeout(function(){d.removeClass(c+"flip"),b.appendTo(d.children("."+c+"front"));var a=d.find("."+c+"front img:first").detach();a.data("remove")!==!0&&(f.$hiddenImages=f.$hiddenImages.add(a)),f.flipping=!1,f.flipCounter++},this.settings.animationDuration+100),0==this.$availableTiles.length&&this._resetAvailableTiles()}},_trigger:function(a,b,c){var e="on"+a.ucfirst(),f=this.settings[e];if("function"==typeof f){var g=c?c:this.$target;f.apply(g,b)}a=d+a.ucfirst(),this.$target.trigger(a,b)},start:function(){if(!this.active){var a=this;this.interval=setInterval(function(){a._flipImage()},this.settings.flipInterval),this.active=!0,this._setCssClasses(),this._trigger("start")}},stop:function(){this.active&&(clearInterval(this.interval),this.active=!1,this._setCssClasses(),this._trigger("stop"))},next:function(){this._flipImage()},isActive:function(){return this.active},enable:function(){this.settings.enabled=!0,this._setCssClasses()},disable:function(){this.settings.enabled=!1,this._setCssClasses()},isDisabled:function(){return 0==this.settings.enabled},add:function(b){var c=this;a(b).each(function(){var b=c._cloneImage(a(this));c.$hiddenImages=c.$hiddenImages.add(b),c._trigger("add",[a(this)])}),this.settings.randomImages&&(this.$hiddenImages.shuffle(),this.flipCounter=0)},remove:function(b){var f,d=this,e=[];"string"==typeof b?e.push(b):a(b).each(function(){e.push(a(this).attr("src"))});var g=this.$tiles.find(":not(."+c+"custom) img").add(this.$hiddenImages);g.each(function(){for(var b=0;b<e.length;b++)a(this).attr("src")==e[b]&&(d._trigger("remove",[a(this)]),(f=d.$hiddenImages.index(a(this)))>-1?d.$hiddenImages.splice(f,1):a(this).addClass(c+"removing").data("remove",!0))})},option:function(b,c){if(!b)return a.extend({},this.settings);var d;if("string"==typeof b){if(1===arguments.length)return void 0!==this.settings[b]?this.settings[b]:null;d={},d[b]=c}else d=b;this._setOptions(d)},_setOptions:function(a){for(key in a){var b=a[key];this.settings[key]=b,"flipInterval"==key&&this.active?(this.stop(),this.start()):"animationDuration"==key?this._updateHeadCss():"randomDestinationTiles"==key&&this._resetAvailableTiles(),("enabled"==key||"randomImages"==key||"randomDestinationTiles"==key)&&this._setCssClasses()}},destroy:function(){this._trigger("destroy"),this.active&&this.stop(),this.$wrapper.remove(),this._removeHeadCss(),this.$target.data("visible")&&this.$target.show(),this.$target.removeData(b,this)}},a.fn.apFlipGallery=function(c){if("string"==typeof c){var d,e,h=[],i=Array.prototype.slice.call(arguments,1);return this.each(function(){if(d=a(this).data(b)){if("function"==typeof(e=d[c])&&"_"!==c.charAt(0)){var f=e.apply(d,i);void 0!==f&&h.push(f)}}else h.push(void 0)}),h.length?1===h.length?h[0]:h:this}return this.each(function(){new g(this,c)})},g.defaultSettings={id:void 0,tileCount:void 0,customTiles:[],flipInterval:5e3,animationDuration:500,autoStart:!0,enabled:!0,randomImages:!0,randomDestinationTiles:!0}}(jQuery);